# 视觉大模型驱动的页面异常检测：突破传统视觉方法瓶颈

导语：在页面异常检测领域，传统视觉方法长期面临难以突破的瓶颈：无论是基于规则的模板匹配，还是依赖人工设计特征的传统 CV 模型，都难以应对复杂场景下的多样挑战 —— 比如不同服务的报错提示样式和文案的千差万别，不同平台的控件错位、字体错乱等异常表现的差异显著。这些场景往往需要大量的人工调参和特征工程，不仅泛化能力有限，还难以覆盖边缘 case。​
而视觉大模型的兴起，为解决这一困境提供了新的技术路径。其强大的视觉理解能力与思考能力，能够直接识别页面的元素和位置，无需依赖人工预设规则，便可对报错信息、文字重叠、内容缺失等异常进行准确检测。​
本文将聚焦视觉大模型在页面异常检测中的实践，拆解如何利用大模型突破传统视觉方法的局限，以及在方案设计中需要关注的技术细节与探索方向。

### 一、背景
页面巡检作为自动化测试中的关键环节，其核心愿景始终围绕：通过快速识别页面异常，避免问题传导至用户端影响体验，从而最大限度降低异常带来的业务损失。

在没有页面巡检的情况下，页面问题的发现往往依赖用户反馈与监控工具对日志的分析 —— 这种模式不仅存在明显滞后性（问题已影响用户），还难以覆盖无明确性能指标的视觉异常（如布局错位、元素缺失）。

相比之下，服务端异常检测已经有了一套成熟的监控方案。通过分析系统日志、追踪数据传输链路，就能快速发现问题并准确定位故障点。但在页面异常检测场景，不同终端屏幕尺寸不一，界面操作流程、UI组件库的使用各不相同，传统的图像识别方法很难适应这些复杂场景，经常会出现检测不准确的情况。

具体来看，页面异常存在多种典型场景，而传统方法在应对时往往力不从心：

1. 元素显示不完整
   如下图所示，弹窗内元素仅显示左半部分，信息缺失严重且影响用户操作，传统基于规则匹配的方法难以精准识别此类异常。
   
   <img title="" src="https://cdn-y.tencentmusic.com/8e47e36baa90dd842f0ef5941b4dd97e.png" alt="图1.元素显示不完整" width="309" style="display: block; margin: 0 auto;">

2. 图片加载异常
   下图中歌曲封面未能完整加载，仅以占位符呈现，传统方法如果对所有可能的占位符进行模板匹配，所需成本非常高，而基于采样的空白检测又需要根据不同的页面、设备专门设置不同的阈值等参数。
   
   <img title="" src="https://cdn-y.tencentmusic.com/986e8a75e2dfcea3289fc257e5e61df9.png" alt="图2.图片加载异常" width="318" style="display: block; margin: 0 auto;">

3. “错误提示”还是“异常信息”？
   面对复杂系统时，传统的视觉识别方法的局限性体现得愈发明显。如下图展示的界面，虽出现 “系统异常请联系管理员或稍后重新发起导入任务” 提示文本，但实际为业务逻辑的错误提示而非页面异常。如果用 OCR 技术检测出来了“异常文本”，是否应判定为页面异常并上报，都是传统方法面对的难题。
   
   <img title="" src="https://cdn-y.tencentmusic.com/f45dc7c9d6e3a8d130d6e7ad222482ef.png" alt="图3.正常页面" width="657" style="display: block; margin: 0 auto;">

### 二、方案选型

使用视觉大模型进行页面异常检测，核心在于3个关键环节

#### 2.1 模型选型

页面异常识别对大模型可以说是非常 “挑剔”了—— 既需具备强大的图像理解能力，能准确识别页面元素；又要有精准的判断能力，将误漏报率控制在极低水平；同时需平衡资源成本与识别效率等工程指标。

为了方便测试模型和提示词，用AI快速做了一个web小工具:

<img title="" src="https://cdn-y.tencentmusic.com/cceccbf395ac37cef368a1debe23a530.png" alt="图4.工具界面" width="599" style="display: block; margin: 0 auto;">

在初步了解后，选择了Claude-Sonnet-4、Qwen2.5-VL-32B、Qwen3-235B-A22B、Gemini2.5 Pro和GLM-4.1V-Thinking作为调研对象。测试结果中，Claude-Sonnet-4，Qwen2.5-VL-32B和GLM-4.1V-Thinking的表现都符合我们的预期。

【识别效果以Qwen2.5-VL-32B为100%，测试了74张图片】

|           |                   |                  |           |
|:---------:|:-----------------:|:----------------:|:---------:|
|           | **ClaudeSonnet4** | **Gemini2.5Pro** | **Qwen3** |
| 识别速度(avg) | 8.4s              | 27.1s            | 54.7s     |
| 识别效果      | 95%               | 90%              | 40%       |

但是Claude-Sonnet-4首先是成本较高，其次是作为外部闭源模型可能有信息安全隐患，而Qwen2.5-VL-32B我们也没有足够的GPU资源进行本地部署。

在测试结果中，[GLM-4.1V-Thinking](https://huggingface.co/THUDM/GLM-4.1V-9B-Thinking) 作为一个9B参数量的开源视觉大模型，在识别速度和效果方面都算优秀，而且成本较低（智谱官方提供低并发量的免费API，且模型参数量不大，可以本地部署）。

放几张检测结果图:
<img title="" src="https://cdn-y.tencentmusic.com/0cac5e6c1efffce28c30d908a4ae9a7d.png" alt="检测结果1" width="673" style="display: block; margin: 0 auto;">
<img title="" src="https://cdn-y.tencentmusic.com/06caa665effd438e354db6ed0be7a560.png" alt="检测结果2" width="692" style="display: block; margin: 0 auto;">

#### 2.2 提示词优化

提示词也是影响检测效果非常重要的一部分，甚至只改变几句话都会让检测效果大打折扣甚至误报乱报。

刚开始尝试让大模型直接给出异常的具体坐标，但是不同模型对于分辨率的识别能力大不相同，于是在Prompt中要求它输出归一化的坐标，随后自己再根据图像的分辨率还原真实坐标进行画框。

对于输出格式的约束也是一个难点，由于GLM-4.1V-Thinking不支持Tool Calling和结果检查，最后选择了在Prompt中规范大模型的输出 + 高容忍性的结果提取解析的方案。

测试过程中，发现GLM-4.1V-Thinking经常检测不出来文字重叠的异常情况，因此还对要求了大模型对文本重叠进行了重点检测，给出一个示例Prompt:

```markdown
你是一个专业的页面异常检测系统，负责分析各类页面截图（包括Web页面、移动端界面等），发现所有可能的页面异常。请严格按照以下步骤和要求执行：

## 检测步骤

### 第一步：文字区域详细检查（必须执行）
- 依次检查页面的主要文字区域。
- 对每个文字区域，判断：
  - 能否清晰读出文字内容？
  - 文字行与行之间是否有正常间距？
  - 是否存在多行文字叠加、密度异常高、无法区分的情况？（水印不属于异常）
- 对于无法清晰阅读、文字重叠、密度异常高的区域，**必须标记为 rendering_issue**，严重程度为 high。

### 第二步：全局异常检测
- 检查所有常见页面异常，包括但不限于：
  - **incomplete_element**: 元素显示不完整（如文字、图片、按钮等被截断）
  - **error_message**: 错误提示信息（如“加载失败”、“404”等）
  - **layout_anomaly**: 布局错位、不对称、容器溢出
  - **loading_issue**: loading 卡住、图片加载失败
  - **empty_content**: 应有内容但显示空白，"暂无数据"不一定属于异常
  - **rendering_issue**: 渲染问题（如元素重叠、样式丢失等视觉问题）

## 输出要求
- **必须输出纯JSON，合并所有检测到的异常，严格按如下格式：**

{
  "anomaly_detected": true,
  "anomalies": [
    {
      "type": "rendering_issue",
      "bbox": [0.0, 0.0, 0.5, 0.4],
      "confidence": 0.95,
      "severity": "high",
      "description": "左上角区域文字重叠，无法清晰阅读"
    },
    {
      "type": "incomplete_element",
      "bbox": [0.5, 0.2, 0.7, 0.3],
      "confidence": 0.9,
      "severity": "high",
      "description": "按钮显示不完整，右侧被截断"
    }
  ]
}


- **无异常时输出：**

  {
  "anomaly_detected": false,
  "anomalies": []
  }


- **bbox**格式：[x1, y1, x2, y2]，归一化坐标（0-1范围），必须准确标记异常区域实际位置，不得使用示例坐标。

## 严重程度

- **high**: 严重影响使用（如内容截断、明显错误、文字重叠无法阅读）
- **medium**: 部分影响体验（如轻微错位）
- **low**: 轻微问题（如颜色略异常）

## 检测重点提醒

- 先检查所有文字区域的可读性，再检查其他异常。
- 任何无法清晰阅读的文字区域都必须标记为 rendering_issue。
- 不要遗漏元素不完整、加载异常、布局错位等其他问题。
- 输出时合并所有异常，确保每个异常都单独标注 bbox、类型、置信度、严重程度和描述。

请仔细观察页面截图，确保不遗漏任何显示异常，尤其注意文字区域的可读性和页面元素的完整性。
```

#### 2.3 参数调优

这里指的是设置的 `temperature`、`top_p`等参数。

【概念引用自[PromptEngineeringGuide](https://www.promptingguide.ai/zh/introduction/settings) 】

> **Temperature**：简单来说，`temperature` 的参数值越小，模型就会返回越确定的一个结果。如果调高该参数值，大语言模型可能会返回更随机的结果，也就是说这可能会带来更多样化或更具创造性的产出。（调小`temperature`）实质上，你是在增加其他可能的 token 的权重。在实际应用方面，对于质量保障（QA）等任务，我们可以设置更低的 `temperature` 值，以促使模型基于事实返回更真实和简洁的结果。 对于诗歌生成或其他创造性任务，适度地调高 `temperature` 参数值可能会更好。
> **Top_p**：同样，使用 `top_p`（与 `temperature` 一起称为核采样（nucleus sampling）的技术），可以用来控制模型返回结果的确定性。如果你需要准确和事实的答案，就把参数值调低。如果你在寻找更多样化的响应，可以将其值调高点。
> 使用Top P意味着只有词元集合（tokens）中包含`top_p`概率质量的才会被考虑用于响应，因此较低的`top_p`值会选择最有信心的响应。这意味着较高的`top_p`值将使模型考虑更多可能的词语，包括不太可能的词语，从而导致更多样化的输出。
> 一般建议是改变 Temperature 和 Top P 其中一个参数就行，不用两个都调整。

由于我们需要确定、稳定的异常检测，最终设定了较低的 `temperature` 值来保证尽可能低的误报率。

### 三、检测效果

目前该异常检测方案作为一个辅助检测能力已经在我们页面巡检服务的灰度环境上线试运行一段时间了，对于一些常见异常的检测效果还是很不错的。

展示一些异常检测效果：

1. 文本重叠
   <img title="" src="https://cdn-y.tencentmusic.com/f4735d8cac0f4de1f6437f2a146b285c.png" alt="文本重叠" style="display: block; margin: 0 auto;">

2. 卡加载
   <img title="" src="https://cdn-y.tencentmusic.com/dee592533220f8c99c9722bdd44d022d.png" alt="卡加载" style="display: block; margin: 0 auto;">

3. 报错提示
   <img title="" src="https://cdn-y.tencentmusic.com/8ad0a976c336ea394d797418fc6b89bd.png" alt="报错提示" style="display: block; margin: 0 auto;">

4. 异常加载&&区域白屏
   <img title="" src="https://cdn-y.tencentmusic.com/432446439e251e7e4d829d9863ba1580.png" alt="异常加载和区域白屏" style="display: block; margin: 0 auto;">

5. 报错提示
   
   <img title="" src="https://cdn-y.tencentmusic.com/f97f6f1f2a8a28631fe07c139c1ae658.png" alt="报错提示" style="display: block; margin: 0 auto;">

目前在保持原有页面巡检方案的同时，异步进行AI页面异常检测，发现异常后就通过BOT机器人企微通知。

<img title="" src="https://cdn-y.tencentmusic.com/b972706dd3821dd6ab271f70a25c1e57.png" alt="图5.BOT通知" width="505" style="display: block; margin: 0 auto;">

### 四、总结

#### 4.1 AI异常检测方案的优点

基于视觉大模型进行页面异常检测，首先省去了人工进行特征工程的步骤，不仅更加灵活通用，而且检测效果也更好。在根据业务、需求微调好了Prompt和参数后便可以长期稳定地进行多样化检测，突破了传统CV方法的瓶颈，能轻松胜任很多以前难以完成的异常检测任务。

其次，视觉大模型的发展日新月异，GLM-4.1V-Thinking就是最近发布的具有优秀图像理解能力的小参数模型。相信随着相关技术的不断发展和完善，该方案的性能和成本都会令人愈发满意。

#### 4.2 AI异常检测方案目前的不足

根据之前的调研和试运行的结果来看，目前使用AI进行页面异常检测遇到的问题主要是:

1. 机器资源需求大
   即便是使用9B小参数的大模型，对显存的占用也是较高的。【如果使用智谱官方提供的免费API，请务必做好**信息安全防护**】
2. 仍存在误报漏报
   目前的视觉大模型对于“**页面异常**”的识别能力也还是没有达到人工判断的水平，因此还是存在着误报漏报的情况，但是通过调整Prompt和参数可以控制误漏报率在一个符合需求的范围内。

#### 4.3 后续优化方向

目前基于视觉大模型进行页面异常检测已经到了可以投入使用的阶段，需要优化的指标主要有3个:

1. 识别时间
   在之前的调研结果中，使用智谱API `GLM-4.1V-Thinking` 的平均识别时间是5s左右一张，但是不同机器的性能差异、不同服务提供方的请求限制均会导致这个识别时间上升，优化的方向主要有：提示机器性能、尝试图片压缩等。

2. 误漏报率
   目前我们对于误漏报率的控制达到了这样的成果:
   误报率<1%，漏报率<3%，符合预期。
   但是对于页面巡检的终极目标来说肯定是希望2项数据均为0的，优化的方向主要有：调整Prompt、寻找更好的模型、调整参数等。

3. 识别准确率
   目前在能识别出异常的场景下，大模型给出的异常信息都是准确的，但是返回的异常区域坐标有时会有一些偏差，如下图所示:

<img title="" src="https://cdn-y.tencentmusic.com/d22ae01064f1ce42da133e4ae4e54d7b.png" alt="图6.识别准确率" width="543" style="display: block; margin: 0 auto;">

   对于这一点，之前提到的让大模型输出归一化坐标的方法已经优化了很多了，但是后续还是希望能够给出更精准的坐标

### 最后

#### 关于讨论

基于视觉大模型进行页面异常检测未来将会是异常监控的主流方案。大家如果有相似的idea，或者想讨论相关技术细节、实现方案等都非常欢迎～

#### 彩蛋

一开始给出的3个场景，AI检测的效果怎么样呢？
<img title="" src="https://cdn-y.tencentmusic.com/5cbe08f15505fc61614f6c966aff9fd4.png" alt="图7.开头检测1" width="326" style="display: block; margin: 0 auto;">
<img title="" src="https://cdn-y.tencentmusic.com/69e94689a1692146e1c4cd4a47d933bb.png" alt="图8.开头检测2" width="332" style="display: block; margin: 0 auto;">
<img title="" src="https://cdn-y.tencentmusic.com/a3a796f390c9149fc9e18725cb1b1864.png" alt="图9.开头检测3" style="display: block; margin: 0 auto;">
